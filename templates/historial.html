{% extends "base.html" %}
{% block content %}
<h2>Historial de Préstamos</h2>

{% if prestamos|length == 0 %}
<div class="alert alert-info">No hay préstamos en el historial.</div>
{% else %}
<table class="table table-hover">
    <thead class="table-dark">
        <tr>
            <th>Fecha Préstamo</th>
            <th>Alumno</th>
            <th>Equipo</th>
            <th>Fecha Devolución</th>
            <th>Fecha Límite</th>
            <th>Estado</th>
            <th>Multa</th>
        </tr>
    </thead>
    <tbody>
        {% for p in prestamos %}
        <tr class="{{ 'table-danger' if p.multa_aplicada > 0 else '' }}">
            <td>{{ p.fecha_prestamo.strftime('%d/%m/%Y %H:%M') }}</td>
            <td>{{ p.alumno.nombre }} ({{ p.alumno.codigo }})</td>
            <td>{{ p.equipo.nombre }} ({{ p.equipo.codigo }})</td>
            <td>
                {% if p.fecha_devolucion %}
                {{ p.fecha_devolucion.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                <span class="text-muted">No devuelto</span>
                {% endif %}
            </td>
            <td>
                {% if p.fecha_prevista_devolucion %}
                {{ p.fecha_prevista_devolucion.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                <span class="text-muted">No establecida</span>
                {% endif %}
            </td>
            <td>
                <span class="badge bg-{{ 'success' if p.estado == 'Devuelto' else 'warning' }}">
                    {{ p.estado }}
                </span>
            </td>
            <td>
                {% if p.multa_aplicada > 0 %}
                <span class="badge bg-danger fs-6">
                    ${{ p.multa_aplicada }} ({{ p.dias_retraso }} días)
                </span>
                {% else %}
                <span class="text-success">Sin multa</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}